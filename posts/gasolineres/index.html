<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content=" ">
    <meta name="description" content="/">
    <meta name="keywords" content="blog, economics,personal">
    
    <meta property="og:site_name" content="Smooth as consumption">
    <meta property="og:title" content="
  Localización y precios de gasolineras españolas - Smooth as consumption
">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/posts/gasolineres/">
    <meta property="og:image" content="/">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="/posts/gasolineres/">
    <meta name="twitter:image" content="/">

    <base href="/">
    <title>
  Localización y precios de gasolineras españolas - Smooth as consumption
</title>

    <link rel="canonical" href="/posts/gasolineres/">
    
    <link  rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700">
    <link rel="stylesheet" href="//cdn.rawgit.com/necolas/normalize.css/master/normalize.css">
    <link rel="stylesheet" href="/css/style.min.css">

    

    

    <link rel="icon" type="image/png" href="/images/logos/avatar.png" sizes="32x32"/>

    

    <meta name="generator" content="Hugo 0.53" />
  </head>

  <body class="">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">Smooth as consumption</a>
    <input type="checkbox" id="menu-control"/>
    <label class="menu-mobile  float-right " for="menu-control">
      <span class="btn-mobile  float-right ">&#9776;</span>
      <ul class="navigation-list">
        
          
            <li class="navigation-item  align-center ">
              <a class="navigation-link" href="/about">About</a>
            </li>
          
            <li class="navigation-item  align-center ">
              <a class="navigation-link" href="/projects">Projects</a>
            </li>
          
            <li class="navigation-item  align-center ">
              <a class="navigation-link" href="/posts">Blog</a>
            </li>
          
        
        
      </ul>
    </label>
  </section>
  

    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
    
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true,
            processEnvironments: true
        },
        // Center justify equations in code and markdown cells. Elsewhere
        // we use CSS to left justify single line equations in code cells.
        displayAlign: 'center',
        "HTML-CSS": {
            styles: {'.MathJax_Display': {"margin": 0}},
            linebreaks: { automatic: true }
        }
    });
    </script>
    
</nav>


      <div class="content">
        
  <section class="container post">
  <article>
    <header>
      <h1 class="title">Localización y precios de gasolineras españolas</h1>
      <h2 class="date">April 7, 2017</h2>

      
    </header>

    


<p>En esta entrada voy a replicar, usando R, algunos de los mapas sobre precios de gasolineras que se hacen <a href="https://www.r-bloggers.com/maps-are-great-german-gas-prices-illustrated/">aquí</a> con datos de España.</p>
<p>El fichero y todo el código que uso se puede encortar en este repositorio de Github. Primero de todo, se hacen los preparativos. Los datos son actualizados cada hora por el gobierno:</p>
<p><a href="https://sede.minetur.gob.es/es-ES/datosabiertos/catalogo/precios-carburantes" class="uri">https://sede.minetur.gob.es/es-ES/datosabiertos/catalogo/precios-carburantes</a></p>
<p>Por desgracia los datos nos son almacenados, de forma que los datos previos son sobrescritos por los huevos datos. <a href="https://github.com/LlucPuigCodina/SpanishFuelPrices">Aquí pueden encontrar un repositorio de GitHub</a> donde hay los datos que uso y un fichero de R con el que pueden replicar todos los mapas.</p>
<pre class="r"><code>#First of all, tidy up!
rm(list=ls())

#Packages and Library
library(readxl)
library(ggplot2)
library(ggmap)

#Loading the dataframe
df = read_excel(&quot;../private storage/data.xls&quot;, col_names = TRUE, skip = 4) 
colnames(df)[9] &lt;- &quot;Preciogasolina95&quot;

#Getting the base map
Spain.map &lt;- get_map(location = &quot;Spain&quot;,
                      color = &quot;bw&quot;,
                      source = &quot;google&quot;,
                      maptype = &quot;roadmap&quot;,
                      zoom = 6)</code></pre>
<p>Vayamos a por el primer gráfico:</p>
<pre class="r"><code>#Plotting

##Putting Gas Stations on the Map
p &lt;- ggmap(Spain.map)
p &lt;- p + geom_point(data=df, aes(y=Latitud , x=Longitud, color=Preciogasolina95)) 
p &lt;- p + scale_color_gradient(low = &quot;black&quot;, high = &quot;blue&quot;, guide=guide_legend(title = &quot;Fuel 95 Price&quot;))
p  + theme(axis.title=element_blank(),
           axis.text=element_blank(),
           axis.ticks=element_blank()) + ggtitle(&quot;Spanish Gas Stations&quot;)</code></pre>
<center>
<img src="https://raw.githubusercontent.com/LlucPuigCodina/SpanishFuelPrices/master/Output/Putting%20Gas%20Stations%20on%20the%20Map.png"/>
</center>
<p>Al haber muchos puntos en el mapa, mejor hacer un mapa de densidad.</p>
<pre class="r"><code>##Density Map of Gas Stations
options(stringsAsFactors=T)  ## need to run this --- weird ggplot bug=!

p &lt;- ggmap(Spain.map)
p &lt;- p  +  stat_density_2d(bins=30, geom=&#39;polygon&#39;, size=2, data=df, aes(x = Longitud, y = Latitud, alpha=..level.., fill = ..level..))
p &lt;- p  +  scale_fill_gradient(low = &quot;blue&quot;, high = &quot;black&quot;, guide=FALSE) +  scale_alpha(range = c(0.02, 0.8), guide = FALSE) +xlab(&quot;&quot;) + ylab(&quot;&quot;)
p  + theme(axis.title=element_blank(),
           axis.text=element_blank(),
           axis.ticks=element_blank()) + ggtitle(&quot;Spanish Gas Station Density&quot;)</code></pre>
<center>
<img src="https://raw.githubusercontent.com/LlucPuigCodina/SpanishFuelPrices/master/Output/Density%20Map%20of%20Gas%20Stations.png"/>
</center>
<p>Para ver si en diversas regiones hay diferentes precios, podemos dividir en grupos por rango de precio a las diversas gasolineras y hacer un mapa de densidad para cada rango. Podemos observar que, curiosamente, en Cataluña hay muchas gasolineras ‘baratas’ y ‘caras’ a la vez.</p>
<pre class="r"><code>##Density Map of Gas Stations by Price Cluster
require(Hmisc)
df$priceGroups &lt;- cut2(df$Preciogasolina95, g = 4)
p &lt;- ggmap(Spain.map)
p &lt;- p  +  stat_density_2d(geom = &quot;polygon&quot;, na.rm = TRUE, bins = 30,data=df, aes(x = Longitud, y = Latitud, alpha=..level.., fill = ..level..))
p &lt;- p+ facet_wrap(~priceGroups) + scale_fill_gradient(low = &quot;black&quot;, high = &quot;blue&quot;, guide=FALSE) +  scale_alpha(range = c(0.02, 0.8), guide = FALSE) +xlab(&quot;&quot;) + ylab(&quot;&quot;)
p  + theme(axis.title=element_blank(),
           axis.text=element_blank(),
           axis.ticks=element_blank())  + ggtitle(&quot;Gas Price Clusters&quot;)</code></pre>
<center>
<img src="https://raw.githubusercontent.com/LlucPuigCodina/SpanishFuelPrices/master/Output/Density%20Map%20of%20Gas%20Stations%20by%20Price%20Cluster.png"/>
</center>
<p>Para un análisis de como el número de gasolineras supuestamente induce a precios bajos pueden leer <a href="https://flovv.github.io/Gas_price-Proximity/">esta entrada</a> del mismo autor.</p>
<p>Me abstengo de hacer tal análisis ya que cabe considerar la posibilidad de que las gasolineras quieran situarse en los sitios donde hay precios más altos. La entrada no tiene en cuenta esto ni tampoco diferencias de demanda locales con lo que no se pueden hacer afirmaciones causales con ese tipo de análisis si tenemos causalidad simultánea.</p>

  </article>

  <br/>

  
      <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "@llucpuigcodina" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  
  
</section>

      </div>
      
        <footer class="footer">
  <section class="container">
    
     © 2018  

  </section>
</footer>

      
    </main>

    

  <script src="/js/app.js"></script>
  
  <script>
  (function($) {
    $(function() {
      $('#privateTrigger').on('click', function() {
        $('.private').slideToggle();
        $('#privateTriggerText').text(" ");
      });
    });
   })(jQuery);
  </script>
  
  </body>
</html>
